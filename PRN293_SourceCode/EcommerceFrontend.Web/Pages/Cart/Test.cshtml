@page
@model EcommerceFrontend.Web.Pages.Cart.TestModel
@{
    ViewData["Title"] = "Test Backend Connection";
}

<div class="container mt-4">
    <h2>Backend Connection Test</h2>
    
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Test Backend Connection</h5>
                </div>
                <div class="card-body">
                    <button id="testBackendBtn" class="btn btn-primary">Test Backend</button>
                    <div id="testResult" class="mt-3"></div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Test Cart API</h5>
                </div>
                <div class="card-body">
                    <button id="testCartBtn" class="btn btn-success">Test Cart</button>
                    <div id="cartResult" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Check Authentication Status</h5>
                </div>
                <div class="card-body">
                    <button id="checkAuthBtn" class="btn btn-info">Check Auth Status</button>
                    <div id="authResult" class="mt-3"></div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Quick Actions</h5>
                </div>
                <div class="card-body">
                    <a href="/LoginPage/Login" class="btn btn-warning">Go to Login</a>
                    <a href="/Cart" class="btn btn-secondary">Go to Cart</a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>Logs</h5>
                </div>
                <div class="card-body">
                    <pre id="logs" style="max-height: 400px; overflow-y: auto; background-color: #f8f9fa; padding: 10px;"></pre>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function addLog(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.textContent += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
        }
        
        document.getElementById('testBackendBtn').addEventListener('click', async function() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div class="alert alert-info">Testing...</div>';
            addLog('Testing backend connection...');
            
            try {
                const response = await fetch('/api/Cart/test');
                const data = await response.json();
                
                addLog(`Backend test response: ${JSON.stringify(data, null, 2)}`);
                
                if (data.success) {
                    resultDiv.innerHTML = '<div class="alert alert-success">Backend connection successful!</div>';
                } else {
                    resultDiv.innerHTML = `<div class="alert alert-danger">Backend connection failed: ${data.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                addLog(`Backend test error: ${error.message}`);
                resultDiv.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });
        
        document.getElementById('testCartBtn').addEventListener('click', async function() {
            const resultDiv = document.getElementById('cartResult');
            resultDiv.innerHTML = '<div class="alert alert-info">Testing cart...</div>';
            addLog('Testing cart API...');
            
            try {
                const response = await fetch('/api/Cart');
                const data = await response.json();
                
                addLog(`Cart test response: ${JSON.stringify(data, null, 2)}`);
                
                if (data.success) {
                    resultDiv.innerHTML = '<div class="alert alert-success">Cart API working!</div>';
                } else {
                    resultDiv.innerHTML = `<div class="alert alert-danger">Cart API failed: ${data.message || 'Unknown error'}</div>`;
                }
            } catch (error) {
                addLog(`Cart test error: ${error.message}`);
                resultDiv.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });
        
        document.getElementById('checkAuthBtn').addEventListener('click', async function() {
            const resultDiv = document.getElementById('authResult');
            resultDiv.innerHTML = '<div class="alert alert-info">Checking auth status...</div>';
            addLog('Checking authentication status...');
            
            try {
                const response = await fetch('/api/Cart/auth-status');
                const data = await response.json();
                
                addLog(`Auth status response: ${JSON.stringify(data, null, 2)}`);
                
                if (data.success) {
                    if (data.isAuthenticated) {
                        resultDiv.innerHTML = '<div class="alert alert-success">User is authenticated!</div>';
                    } else {
                        resultDiv.innerHTML = '<div class="alert alert-warning">User is not authenticated. Please login.</div>';
                    }
                } else {
                    resultDiv.innerHTML = `<div class="alert alert-danger">Auth check failed: ${data.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                addLog(`Auth check error: ${error.message}`);
                resultDiv.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });
        
        // Auto-test on page load
        window.addEventListener('load', function() {
            addLog('Page loaded. Ready to test backend connection.');
        });
    </script>
} 