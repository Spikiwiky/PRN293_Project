@page
@model EcommerceFrontend.Web.Pages.Sale.Products.CreateModel
@{
    ViewData["Title"] = "Create Product";
}

<h1>Create Product</h1>

<form method="post">
    <!-- Basic Info -->
    <div class="form-group">
        <label asp-for="Product.Name"></label>
        <input asp-for="Product.Name" class="form-control" required />
    </div>
    <div class="form-group">
        <label asp-for="Product.Description"></label>
        <input asp-for="Product.Description" class="form-control" required />
    </div>
    <div class="form-group">
        <label asp-for="Product.ProductCategoryId"></label>
        <input asp-for="Product.ProductCategoryId" type="number" class="form-control" />
    </div>
    <div class="form-group">
        <label asp-for="Product.Brand"></label>
        <input asp-for="Product.Brand" class="form-control" />
    </div>
    <div class="form-group">
        <label asp-for="Product.BasePrice"></label>
        <input asp-for="Product.BasePrice" type="number" class="form-control" />
    </div>
    <div class="form-group">
        <label asp-for="Product.Status"></label>
        <input asp-for="Product.Status" type="number" class="form-control" />
    </div>
    <div class="form-check">
        <input asp-for="Product.IsDelete" class="form-check-input" />
        <label asp-for="Product.IsDelete" class="form-check-label"></label>
    </div>

    <!-- Product Image -->
    <h4>Product Image</h4>
    <input asp-for="Product.ProductImages[0].ImageUrl" class="form-control" placeholder="Image URL" />

    <!-- Variants -->
    <h4 class="mt-3">Variants</h4>
    <div id="variantsContainer">
        @for (int i = 0; i < Model.Product.Variants.Count; i++)
        {
            <div class="border p-2 mb-2 variant-row">
                <div class="form-row">
                    <div class="col">
                        <input name="Product.Variants[@i].Size" class="form-control" placeholder="Size" value="@Model.Product.Variants[i].Size" />
                    </div>
                    <div class="col">
                        <input name="Product.Variants[@i].Color" class="form-control" placeholder="Color" value="@Model.Product.Variants[i].Color" />
                    </div>
                    <div class="col">
                        <input name="Product.Variants[@i].Material" class="form-control" placeholder="Material" value="@Model.Product.Variants[i].Material" />
                    </div>
                    <div class="col">
                        <input name="Product.Variants[@i].Supplier" class="form-control" placeholder="Supplier" value="@Model.Product.Variants[i].Supplier" />
                    </div>
                    <div class="col">
                        <input name="Product.Variants[@i].XuatXu" class="form-control" placeholder="Xuất Xứ" value="@Model.Product.Variants[i].XuatXu" />
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-danger btn-sm remove-variant">X</button>
                    </div>
                </div>
            </div>
        }
    </div>

    <button type="button" id="addVariantBtn" class="btn btn-secondary mb-3">Thêm Biến Thể</button>
    <br />
    <button type="submit" class="btn btn-primary">Create</button>
</form>

@section Scripts {
    <script>
        document.getElementById('addVariantBtn').addEventListener('click', addVariant);

        function addVariant() {
            const container = document.getElementById('variantsContainer');
            const index = container.querySelectorAll('.variant-row').length;
            const html = `
                <div class="border p-2 mb-2 variant-row">
                    <div class="form-row">
                        <div class="col">
                            <input name="Product.Variants[${index}].Size" class="form-control" placeholder="Size" />
                        </div>
                        <div class="col">
                            <input name="Product.Variants[${index}].Color" class="form-control" placeholder="Color" />
                        </div>
                        <div class="col">
                            <input name="Product.Variants[${index}].Material" class="form-control" placeholder="Material" />
                        </div>
                        <div class="col">
                            <input name="Product.Variants[${index}].Supplier" class="form-control" placeholder="Supplier" />
                        </div>
                        <div class="col">
                            <input name="Product.Variants[${index}].XuatXu" class="form-control" placeholder="Xuất Xứ" />
                        </div>
                        <div class="col-auto">
                            <button type="button" class="btn btn-danger btn-sm remove-variant">X</button>
                        </div>
                    </div>
                </div>`;
            container.insertAdjacentHTML('beforeend', html);
        }

        document.addEventListener('click', function (e) {
            if (e.target && e.target.classList.contains('remove-variant')) {
                e.target.closest('.variant-row').remove();
            }
        });
    </script>
}
